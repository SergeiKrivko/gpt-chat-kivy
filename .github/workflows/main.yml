name: Build
on: [push, pull_request]

jobs:
  # Build job. Builds app for Android with Buildozer
#  build-android:
#    name: Build for Android
#    runs-on: ubuntu-20.04
#
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v2
#        with:
#          path: master
#
#      - name: Set up Python
#        uses: actions/setup-python@v2
#        with:
#          python-version: 3.11
#          architecture: x64
#
#      # used to cache dependencies with a timeout
#      - name: Get Date
#        id: get-date
#        run: |
#          echo "::set-output name=date::$(/bin/date -u "+%Y%m%d")"
#        shell: bash
#
#      - name: Cache Buildozer global directory
#        uses: actions/cache@v2
#        with:
#          path: .buildozer_global
#          key: buildozer-global-${{ hashFiles('buildozer.spec') }} # Replace with your path
#
#      - name: Cache Buildozer local directory
#        uses: actions/cache@v2
#        with:
#          path: .buildozer
#          key: ${{ runner.os }}-${{ steps.get-date.outputs.date }}-${{ hashFiles('buildozer.spec') }}
#
#      - name: Install dependencies
#        run: |
#          python -m pip install --upgrade pip
#          pip install --upgrade Cython
#
#      - name: Build with Buildozer
#        uses: ArtemSBulgakov/buildozer-action@v1
#        id: buildozer
#        with:
#          repository_root: master
#          workdir: .
#          buildozer_version: stable
#
#      - name: Upload artifacts
#        uses: actions/upload-artifact@v2
#        with:
#          name: package
#          path: ${{ steps.buildozer.outputs.filename }}


#  build-android-2:
#    name: Build for Android
#    runs-on: ubuntu-latest
#
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v2
#        with:
#          path: master
#
#      - name: Set up Python
#        uses: actions/setup-python@v2
#        with:
#          python-version: 3.11
#
#      - name: Install dependencies
#        run: |
#          sudo apt install -y git zip unzip openjdk-17-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
#          pip3 install --user --upgrade Cython==0.29.33 virtualenv  # the --user should be removed if you do this in a venv
#          export PATH=$PATH:~/.local/bin/
#
#          python3.11 -m pip install --user --upgrade pip virtualenv
#          python3.11 -m pip install --user --upgrade kivy-ios buildozer
#          python3.11 -m pip install --user --upgrade Cython==0.29.36
#
#      - name: Build with buildozer
#        run: |
#          cd /home/runner/work/gpt-chat-kivy/gpt-chat-kivy/master
#          buildozer android debug
#
#      - name: LS
#        run: |
#          ls
#          ls ./bin


  build-ios:
    name: Build for iOS
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          path: master

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.11

      - name: Install dependencies
        run: |
          brew install sdl2 sdl2_image sdl2_ttf sdl2_mixer gstreamer automake
          export PATH=$PATH:/Users/runner/Library/Python/3.11/bin
          python3.11 -m pip install --user --upgrade pip virtualenv
          python3.11 -m pip install --user --upgrade kivy-ios buildozer
          python3.11 -m pip install --user --upgrade Cython==0.29.36
          ls /Users/runner/Library/Python/3.11/bin

      - name: Build with buildozer
        run: |
          cd /Users/runner/work/gpt-chat-kivy/gpt-chat-kivy/master
          python3.11 -m buildozer ios debug

      - name: LS
        run: |
          ls
          ls ./bin
